<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Markdown::Merge::SmartMerger
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Markdown::Merge::SmartMerger";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Markdown.html" title="Markdown (module)">Markdown</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Merge.html" title="Markdown::Merge (module)">Merge</a></span></span>
     &raquo; 
    <span class="title">SmartMerger</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Markdown::Merge::SmartMerger
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="SmartMergerBase.html" title="Markdown::Merge::SmartMergerBase (class)">SmartMergerBase</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="SmartMergerBase.html" title="Markdown::Merge::SmartMergerBase (class)">SmartMergerBase</a></span></li>
          
            <li class="next">Markdown::Merge::SmartMerger</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/markdown/merge/smart_merger.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Orchestrates the smart merge process for Markdown files using tree_haver backends.</p>

<p>Extends SmartMergerBase with backend-agnostic parsing via tree_haver.<br />
Supports both Commonmarker and Markly backends.</p>

<p>Uses FileAnalysis, FileAligner, ConflictResolver, and MergeResult to<br />
merge two Markdown files intelligently. Freeze blocks marked with<br />
HTML comments are preserved exactly as-is.</p>

<p>SmartMerger provides flexible configuration for different merge scenarios:</p>
<ul>
  <li>Preserve destination customizations (default)</li>
  <li>Apply template updates</li>
  <li>Add new sections from template</li>
  <li>Inner-merge fenced code blocks using language-specific mergers (optional)</li>
</ul>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'><p>Basic merge (destination customizations preserved)</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_merger'>merger</span> <span class='op'>=</span> <span class='const'>SmartMerger</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::SmartMerger#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_template_content'>template_content</span><span class='comma'>,</span> <span class='id identifier rubyid_dest_content'>dest_content</span><span class='rparen'>)</span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_merger'>merger</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span>
<span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>output.md</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
<span class='kw'>end</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>With specific backend</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_merger'>merger</span> <span class='op'>=</span> <span class='const'>SmartMerger</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::SmartMerger#initialize (method)">new</a></span></span><span class='lparen'>(</span>
  <span class='id identifier rubyid_template_content'>template_content</span><span class='comma'>,</span>
  <span class='id identifier rubyid_dest_content'>dest_content</span><span class='comma'>,</span>
  <span class='label'>backend:</span> <span class='symbol'>:markly</span>
<span class='rparen'>)</span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_merger'>merger</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Template updates win</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_merger'>merger</span> <span class='op'>=</span> <span class='const'>SmartMerger</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::SmartMerger#initialize (method)">new</a></span></span><span class='lparen'>(</span>
  <span class='id identifier rubyid_template_content'>template_content</span><span class='comma'>,</span>
  <span class='id identifier rubyid_dest_content'>dest_content</span><span class='comma'>,</span>
  <span class='label'>preference:</span> <span class='symbol'>:template</span><span class='comma'>,</span>
  <span class='label'>add_template_only_nodes:</span> <span class='kw'>true</span>
<span class='rparen'>)</span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_merger'>merger</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Custom signature matching</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_sig_gen'>sig_gen</span> <span class='op'>=</span> <span class='tlambda'>-&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_node'>node</span><span class='rparen'>)</span> <span class='tlambeg'>{</span>
  <span class='id identifier rubyid_canonical_type'>canonical_type</span> <span class='op'>=</span> <span class='const'>Ast</span><span class='op'>::</span><span class='const'>Merge</span><span class='op'>::</span><span class='const'>NodeTyping</span><span class='period'>.</span><span class='id identifier rubyid_merge_type_for'>merge_type_for</span><span class='lparen'>(</span><span class='id identifier rubyid_node'>node</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_canonical_type'>canonical_type</span> <span class='op'>==</span> <span class='symbol'>:heading</span>
    <span class='lbracket'>[</span><span class='symbol'>:heading</span><span class='comma'>,</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_header_level'>header_level</span><span class='rbracket'>]</span>  <span class='comment'># Match by level only, not content
</span>  <span class='kw'>else</span>
    <span class='id identifier rubyid_node'>node</span>  <span class='comment'># Fall through to default
</span>  <span class='kw'>end</span>
<span class='rbrace'>}</span>
<span class='id identifier rubyid_merger'>merger</span> <span class='op'>=</span> <span class='const'>SmartMerger</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::SmartMerger#initialize (method)">new</a></span></span><span class='lparen'>(</span>
  <span class='id identifier rubyid_template_content'>template_content</span><span class='comma'>,</span>
  <span class='id identifier rubyid_dest_content'>dest_content</span><span class='comma'>,</span>
  <span class='label'>signature_generator:</span> <span class='id identifier rubyid_sig_gen'>sig_gen</span>
<span class='rparen'>)</span></code></pre>
    
  </div>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="FileAnalysis.html" title="Markdown::Merge::FileAnalysis (class)">FileAnalysis</a></span></li>
    
      <li><span class='object_link'><a href="SmartMergerBase.html" title="Markdown::Merge::SmartMergerBase (class)">SmartMergerBase</a></span></li>
    
  </ul>

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#backend-instance_method" title="#backend (instance method)">#<strong>backend</strong>  &#x21d2; Symbol </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The backend being used (:commonmarker, :markly).</p>
</div></span>
  
</li>

    
  </ul>



  
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="SmartMergerBase.html" title="Markdown::Merge::SmartMergerBase (class)">SmartMergerBase</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="SmartMergerBase.html#aligner-instance_method" title="Markdown::Merge::SmartMergerBase#aligner (method)">#aligner</a></span>, <span class='object_link'><a href="SmartMergerBase.html#code_block_merger-instance_method" title="Markdown::Merge::SmartMergerBase#code_block_merger (method)">#code_block_merger</a></span>, <span class='object_link'><a href="SmartMergerBase.html#dest_analysis-instance_method" title="Markdown::Merge::SmartMergerBase#dest_analysis (method)">#dest_analysis</a></span>, <span class='object_link'><a href="SmartMergerBase.html#node_typing-instance_method" title="Markdown::Merge::SmartMergerBase#node_typing (method)">#node_typing</a></span>, <span class='object_link'><a href="SmartMergerBase.html#resolver-instance_method" title="Markdown::Merge::SmartMergerBase#resolver (method)">#resolver</a></span>, <span class='object_link'><a href="SmartMergerBase.html#template_analysis-instance_method" title="Markdown::Merge::SmartMergerBase#template_analysis (method)">#template_analysis</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_file_analysis-instance_method" title="#create_file_analysis (instance method)">#<strong>create_file_analysis</strong>(content, **opts)  &#x21d2; FileAnalysis </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Create a FileAnalysis instance for parsing.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destination_parse_error_class-instance_method" title="#destination_parse_error_class (instance method)">#<strong>destination_parse_error_class</strong>  &#x21d2; Class </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the DestinationParseError class to use.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(template_content, dest_content, backend: :auto, signature_generator: nil, preference: :destination, add_template_only_nodes: false, inner_merge_code_blocks: false, freeze_token: FileAnalysis::DEFAULT_FREEZE_TOKEN, match_refiner: nil, node_typing: nil, **parser_options)  &#x21d2; SmartMerger </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Creates a new SmartMerger for intelligent Markdown file merging.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#node_to_source-instance_method" title="#node_to_source (instance method)">#<strong>node_to_source</strong>(node, analysis)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Convert a node to its source text.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#template_parse_error_class-instance_method" title="#template_parse_error_class (instance method)">#<strong>template_parse_error_class</strong>  &#x21d2; Class </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns the TemplateParseError class to use.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="SmartMergerBase.html" title="Markdown::Merge::SmartMergerBase (class)">SmartMergerBase</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="SmartMergerBase.html#merge-instance_method" title="Markdown::Merge::SmartMergerBase#merge (method)">#merge</a></span>, <span class='object_link'><a href="SmartMergerBase.html#merge_result-instance_method" title="Markdown::Merge::SmartMergerBase#merge_result (method)">#merge_result</a></span>, <span class='object_link'><a href="SmartMergerBase.html#stats-instance_method" title="Markdown::Merge::SmartMergerBase#stats (method)">#stats</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(template_content, dest_content, backend: :auto, signature_generator: nil, preference: :destination, add_template_only_nodes: false, inner_merge_code_blocks: false, freeze_token: FileAnalysis::DEFAULT_FREEZE_TOKEN, match_refiner: nil, node_typing: nil, **parser_options)  &#x21d2; <tt><span class='object_link'><a href="" title="Markdown::Merge::SmartMerger (class)">SmartMerger</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Creates a new SmartMerger for intelligent Markdown file merging.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>template_content</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Template Markdown source code</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>dest_content</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Destination Markdown source code</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>backend</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>:auto</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Backend to use for parsing:</p>
<ul>
  <li><code>:commonmarker</code> - Use Commonmarker (comrak Rust parser)</li>
  <li><code>:markly</code> - Use Markly (cmark-gfm C library)</li>
  <li><code>:auto</code> (default) - Auto-detect available backend</li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>signature_generator</span>
      
      
        <span class='type'>(<tt>Proc</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Optional proc to generate custom node signatures.<br />
The proc receives a node (wrapped with canonical merge_type) and should return one of:</p>
<ul>
  <li>An array representing the node’s signature</li>
  <li><code>nil</code> to indicate the node should have no signature</li>
  <li>The original node to fall through to default signature computation</li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>preference</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>:destination</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Controls which version to use when nodes<br />
have matching signatures but different content:</p>
<ul>
  <li><code>:destination</code> (default) - Use destination version (preserves customizations)</li>
  <li><code>:template</code> - Use template version (applies updates)</li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>add_template_only_nodes</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Controls whether to add nodes that only<br />
exist in template:</p>
<ul>
  <li><code>false</code> (default) - Skip template-only nodes</li>
  <li><code>true</code> - Add template-only nodes to result</li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>inner_merge_code_blocks</span>
      
      
        <span class='type'>(<tt>Boolean</tt>, <tt><span class='object_link'><a href="CodeBlockMerger.html" title="Markdown::Merge::CodeBlockMerger (class)">CodeBlockMerger</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Controls inner-merge for<br />
fenced code blocks:</p>
<ul>
  <li><code>true</code> - Enable inner-merge using default CodeBlockMerger</li>
  <li><code>false</code> (default) - Disable inner-merge (use standard conflict resolution)</li>
  <li><code>CodeBlockMerger</code> instance - Use custom CodeBlockMerger</li>
</ul>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>freeze_token</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>FileAnalysis::DEFAULT_FREEZE_TOKEN</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Token to use for freeze block markers.<br />
Default: “markdown-merge”<br />
Looks for: <!-- markdown-merge:freeze --> / <!-- markdown-merge:unfreeze --></p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>match_refiner</span>
      
      
        <span class='type'>(<tt>#call</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Optional match refiner for fuzzy matching of<br />
unmatched nodes. Default: nil (fuzzy matching disabled).<br />
Set to TableMatchRefiner.new to enable fuzzy table matching.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>node_typing</span>
      
      
        <span class='type'>(<tt>Hash{Symbol,String =&gt; #call}</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Node typing configuration<br />
for per-node-type merge preferences. Maps node type names to callables.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>parser_options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Backend-specific parser options.<br />
For commonmarker: { options: {} }<br />
For markly: { flags: Markly::DEFAULT, extensions: [:table] }</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="TemplateParseError.html" title="Markdown::Merge::TemplateParseError (class)">TemplateParseError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>If template has syntax errors</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="DestinationParseError.html" title="Markdown::Merge::DestinationParseError (class)">DestinationParseError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>If destination has syntax errors</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/smart_merger.rb', line 114</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span>
  <span class='id identifier rubyid_template_content'>template_content</span><span class='comma'>,</span>
  <span class='id identifier rubyid_dest_content'>dest_content</span><span class='comma'>,</span>
  <span class='label'>backend:</span> <span class='symbol'>:auto</span><span class='comma'>,</span>
  <span class='label'>signature_generator:</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>preference:</span> <span class='symbol'>:destination</span><span class='comma'>,</span>
  <span class='label'>add_template_only_nodes:</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='label'>inner_merge_code_blocks:</span> <span class='kw'>false</span><span class='comma'>,</span>
  <span class='label'>freeze_token:</span> <span class='const'><span class='object_link'><a href="FileAnalysis.html" title="Markdown::Merge::FileAnalysis (class)">FileAnalysis</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="FileAnalysis.html#DEFAULT_FREEZE_TOKEN-constant" title="Markdown::Merge::FileAnalysis::DEFAULT_FREEZE_TOKEN (constant)">DEFAULT_FREEZE_TOKEN</a></span></span><span class='comma'>,</span>
  <span class='label'>match_refiner:</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='label'>node_typing:</span> <span class='kw'>nil</span><span class='comma'>,</span>
  <span class='op'>**</span><span class='id identifier rubyid_parser_options'>parser_options</span>
<span class='rparen'>)</span>
  <span class='ivar'>@requested_backend</span> <span class='op'>=</span> <span class='id identifier rubyid_backend'>backend</span>
  <span class='ivar'>@parser_options</span> <span class='op'>=</span> <span class='id identifier rubyid_parser_options'>parser_options</span>

  <span class='kw'>super</span><span class='lparen'>(</span>
    <span class='id identifier rubyid_template_content'>template_content</span><span class='comma'>,</span>
    <span class='id identifier rubyid_dest_content'>dest_content</span><span class='comma'>,</span>
    <span class='label'>signature_generator:</span> <span class='id identifier rubyid_signature_generator'>signature_generator</span><span class='comma'>,</span>
    <span class='label'>preference:</span> <span class='id identifier rubyid_preference'>preference</span><span class='comma'>,</span>
    <span class='label'>add_template_only_nodes:</span> <span class='id identifier rubyid_add_template_only_nodes'>add_template_only_nodes</span><span class='comma'>,</span>
    <span class='label'>inner_merge_code_blocks:</span> <span class='id identifier rubyid_inner_merge_code_blocks'>inner_merge_code_blocks</span><span class='comma'>,</span>
    <span class='label'>freeze_token:</span> <span class='id identifier rubyid_freeze_token'>freeze_token</span><span class='comma'>,</span>
    <span class='label'>match_refiner:</span> <span class='id identifier rubyid_match_refiner'>match_refiner</span><span class='comma'>,</span>
    <span class='label'>node_typing:</span> <span class='id identifier rubyid_node_typing'>node_typing</span><span class='comma'>,</span>
    <span class='comment'># Pass through for FileAnalysis
</span>    <span class='label'>backend:</span> <span class='id identifier rubyid_backend'>backend</span><span class='comma'>,</span>
    <span class='op'>**</span><span class='id identifier rubyid_parser_options'>parser_options</span><span class='comma'>,</span>
  <span class='rparen'>)</span>

  <span class='comment'># Capture the resolved backend from template analysis
</span>  <span class='ivar'>@backend</span> <span class='op'>=</span> <span class='ivar'>@template_analysis</span><span class='period'>.</span><span class='id identifier rubyid_backend'>backend</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="backend-instance_method">
  
    #<strong>backend</strong>  &#x21d2; <tt>Symbol</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns The backend being used (:commonmarker, :markly).</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The backend being used (:commonmarker, :markly)</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/smart_merger.rb', line 63</span>

<span class='kw'>def</span> <span class='id identifier rubyid_backend'>backend</span>
  <span class='ivar'>@backend</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create_file_analysis-instance_method">
  
    #<strong>create_file_analysis</strong>(content, **opts)  &#x21d2; <tt><span class='object_link'><a href="FileAnalysis.html" title="Markdown::Merge::FileAnalysis (class)">FileAnalysis</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Create a FileAnalysis instance for parsing.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>content</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Markdown content to analyze</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Analysis options</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="FileAnalysis.html" title="Markdown::Merge::FileAnalysis (class)">FileAnalysis</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>File analysis instance</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


154
155
156
157
158
159
160
161
162</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/smart_merger.rb', line 154</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_file_analysis'>create_file_analysis</span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="FileAnalysis.html" title="Markdown::Merge::FileAnalysis (class)">FileAnalysis</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="FileAnalysis.html#initialize-instance_method" title="Markdown::Merge::FileAnalysis#initialize (method)">new</a></span></span><span class='lparen'>(</span>
    <span class='id identifier rubyid_content'>content</span><span class='comma'>,</span>
    <span class='label'>backend:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:backend</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='ivar'>@requested_backend</span><span class='comma'>,</span>
    <span class='label'>freeze_token:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:freeze_token</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>signature_generator:</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:signature_generator</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='op'>**</span><span class='ivar'>@parser_options</span><span class='comma'>,</span>
  <span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="destination_parse_error_class-instance_method">
  
    #<strong>destination_parse_error_class</strong>  &#x21d2; <tt>Class</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the DestinationParseError class to use.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Class</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Markdown::Merge::DestinationParseError</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/smart_merger.rb', line 174</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destination_parse_error_class'>destination_parse_error_class</span>
  <span class='const'><span class='object_link'><a href="DestinationParseError.html" title="Markdown::Merge::DestinationParseError (class)">DestinationParseError</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="node_to_source-instance_method">
  
    #<strong>node_to_source</strong>(node, analysis)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Convert a node to its source text.</p>

<p>Handles wrapped nodes from NodeTypeNormalizer, gap line nodes,<br />
and link definition nodes created during gap detection.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>node</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Node to convert (may be wrapped)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>analysis</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="FileAnalysis.html" title="Markdown::Merge::FileAnalysis (class)">FileAnalysis</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Analysis for source lookup</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Source text</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/smart_merger.rb', line 186</span>

<span class='kw'>def</span> <span class='id identifier rubyid_node_to_source'>node_to_source</span><span class='lparen'>(</span><span class='id identifier rubyid_node'>node</span><span class='comma'>,</span> <span class='id identifier rubyid_analysis'>analysis</span><span class='rparen'>)</span>
  <span class='comment'># Check for any FreezeNode type (base class or subclass)
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Ast</span><span class='op'>::</span><span class='const'>Merge</span><span class='op'>::</span><span class='const'>FreezeNodeBase</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_full_text'>full_text</span>
  <span class='kw'>end</span>

  <span class='comment'># Handle gap line nodes (created for blank lines and link definitions)
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="LinkDefinitionNode.html" title="Markdown::Merge::LinkDefinitionNode (class)">LinkDefinitionNode</a></span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="GapLineNode.html" title="Markdown::Merge::GapLineNode (class)">GapLineNode</a></span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_node'>node</span><span class='period'>.</span><span class='id identifier rubyid_content'>content</span>
  <span class='kw'>end</span>

  <span class='comment'># Unwrap if needed to access source_position
</span>  <span class='id identifier rubyid_raw_node'>raw_node</span> <span class='op'>=</span> <span class='const'>Ast</span><span class='op'>::</span><span class='const'>Merge</span><span class='op'>::</span><span class='const'>NodeTyping</span><span class='period'>.</span><span class='id identifier rubyid_unwrap'>unwrap</span><span class='lparen'>(</span><span class='id identifier rubyid_node'>node</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_pos'>pos</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_node'>raw_node</span><span class='period'>.</span><span class='id identifier rubyid_source_position'>source_position</span>
  <span class='id identifier rubyid_start_line'>start_line</span> <span class='op'>=</span> <span class='id identifier rubyid_pos'>pos</span><span class='op'>&amp;.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:start_line</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_end_line'>end_line</span> <span class='op'>=</span> <span class='id identifier rubyid_pos'>pos</span><span class='op'>&amp;.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='symbol'>:end_line</span><span class='rparen'>)</span>

  <span class='comment'># Fall back to to_commonmark if no position info
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_raw_node'>raw_node</span><span class='period'>.</span><span class='id identifier rubyid_to_commonmark'>to_commonmark</span> <span class='kw'>unless</span> <span class='id identifier rubyid_start_line'>start_line</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_end_line'>end_line</span>

  <span class='comment'># Get source from line range
</span>  <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='id identifier rubyid_analysis'>analysis</span><span class='period'>.</span><span class='id identifier rubyid_source_range'>source_range</span><span class='lparen'>(</span><span class='id identifier rubyid_start_line'>start_line</span><span class='comma'>,</span> <span class='id identifier rubyid_end_line'>end_line</span><span class='rparen'>)</span>

  <span class='comment'># Handle Markly&#39;s buggy position reporting for :html nodes
</span>  <span class='comment'># where end_line &lt; start_line results in empty source_range.
</span>  <span class='comment'># Fall back to to_commonmark in that case.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_raw_node'>raw_node</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:to_commonmark</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raw_node'>raw_node</span><span class='period'>.</span><span class='id identifier rubyid_to_commonmark'>to_commonmark</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_source'>source</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="template_parse_error_class-instance_method">
  
    #<strong>template_parse_error_class</strong>  &#x21d2; <tt>Class</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the TemplateParseError class to use.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Class</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Markdown::Merge::TemplateParseError</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


167
168
169</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/smart_merger.rb', line 167</span>

<span class='kw'>def</span> <span class='id identifier rubyid_template_parse_error_class'>template_parse_error_class</span>
  <span class='const'><span class='object_link'><a href="TemplateParseError.html" title="Markdown::Merge::TemplateParseError (class)">TemplateParseError</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Feb 19 09:34:59 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-4.0.1).
</div>

    </div>
  </body>
</html>