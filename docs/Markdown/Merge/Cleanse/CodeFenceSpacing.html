<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Markdown::Merge::Cleanse::CodeFenceSpacing
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Markdown::Merge::Cleanse::CodeFenceSpacing";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Markdown.html" title="Markdown (module)">Markdown</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Merge.html" title="Markdown::Merge (module)">Merge</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Cleanse.html" title="Markdown::Merge::Cleanse (module)">Cleanse</a></span></span>
     &raquo; 
    <span class="title">CodeFenceSpacing</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Markdown::Merge::Cleanse::CodeFenceSpacing
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Markdown::Merge::Cleanse::CodeFenceSpacing</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/markdown/merge/cleanse/code_fence_spacing.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Parslet-based parser for fixing malformed fenced code blocks.</p>

<p>A bug in ast-merge (or its dependencies) caused fenced code blocks to be<br />
rendered with a space between the fence markers and the language identifier:</p>

<p>== How It Works</p>

<p>The parser uses a PEG grammar (via Parslet) to recognize fenced code blocks<br />
and detect those with improper spacing. It then reconstructs them with<br />
proper formatting (no space between fence and language).</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'><p>Malformed (buggy) input</p>
</div></h5>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>``` console\nsome code\n```</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Fixed output</p>
</div></h5>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>```console\nsome code\n```</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Basic usage</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Markdown.html" title="Markdown (module)">Markdown</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Merge.html" title="Markdown::Merge (module)">Merge</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cleanse.html" title="Markdown::Merge::Cleanse (module)">Cleanse</a></span></span><span class='op'>::</span><span class='const'>CodeFenceSpacing</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::Cleanse::CodeFenceSpacing#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
<span class='id identifier rubyid_fixed_content'>fixed_content</span> <span class='op'>=</span> <span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_fix'>fix</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Check if content has malformed fences</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Markdown.html" title="Markdown (module)">Markdown</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Merge.html" title="Markdown::Merge (module)">Merge</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cleanse.html" title="Markdown::Merge::Cleanse (module)">Cleanse</a></span></span><span class='op'>::</span><span class='const'>CodeFenceSpacing</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::Cleanse::CodeFenceSpacing#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
<span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_malformed?'>malformed?</span> <span class='comment'># =&gt; true/false</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Process a file</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>README.md</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Markdown.html" title="Markdown (module)">Markdown</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Merge.html" title="Markdown::Merge (module)">Merge</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cleanse.html" title="Markdown::Merge::Cleanse (module)">Cleanse</a></span></span><span class='op'>::</span><span class='const'>CodeFenceSpacing</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::Cleanse::CodeFenceSpacing#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
<span class='kw'>if</span> <span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_malformed?'>malformed?</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>README.md</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_fix'>fix</span><span class='rparen'>)</span>
<span class='kw'>end</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Get details about code blocks</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Markdown.html" title="Markdown (module)">Markdown</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Merge.html" title="Markdown::Merge (module)">Merge</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cleanse.html" title="Markdown::Merge::Cleanse (module)">Cleanse</a></span></span><span class='op'>::</span><span class='const'>CodeFenceSpacing</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::Cleanse::CodeFenceSpacing#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
<span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_code_blocks'>code_blocks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_block'>block</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block'>block</span><span class='lbracket'>[</span><span class='symbol'>:fence</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block'>block</span><span class='lbracket'>[</span><span class='symbol'>:language</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>: malformed=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block'>block</span><span class='lbracket'>[</span><span class='symbol'>:malformed</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>


</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="CodeFenceSpacing/CodeFenceGrammar.html" title="Markdown::Merge::Cleanse::CodeFenceSpacing::CodeFenceGrammar (class)">CodeFenceGrammar</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="FENCE_PATTERN-constant" class="">FENCE_PATTERN =
          <div class="docstring">
  <div class="discussion">
    <p>Pattern to find opening code fences in content<br />
Matches: <code>or ~~~ at start of line, followed by optional info string
Note: Closing fences (just</code>) without info string match but have empty info<br />
We distinguish opening fences by checking if there’s an info string or if<br />
this is the first fence we’ve seen</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(```+|~~~+)([ \t]*)([^\r\n`]*)\r?$</span><span class='regexp_end'>/</span></span></pre></dd>
      
        <dt id="MALFORMED_PATTERN-constant" class="">MALFORMED_PATTERN =
          <div class="docstring">
  <div class="discussion">
    <p>Pattern specifically for malformed fences (space between fence and language)<br />
Language must start with a letter (not just any chars)</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(```+|~~~+)[ \t]+([a-zA-Z][^\r\n`]*)\r?$</span><span class='regexp_end'>/</span></span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#source-instance_method" title="#source (instance method)">#<strong>source</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The input text to parse.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#code_blocks-instance_method" title="#code_blocks (instance method)">#<strong>code_blocks</strong>  &#x21d2; Array&lt;Hash&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Parse and return information about all fenced code blocks.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count-instance_method" title="#count (instance method)">#<strong>count</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Count the total number of code blocks.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fix-instance_method" title="#fix (instance method)">#<strong>fix</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Fix malformed fenced code blocks by removing improper spacing.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(source)  &#x21d2; CodeFenceSpacing </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Create a new parser for the given text.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#malformed%3F-instance_method" title="#malformed? (instance method)">#<strong>malformed?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Check if the source contains malformed fenced code blocks.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#malformed_count-instance_method" title="#malformed_count (instance method)">#<strong>malformed_count</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Count the number of malformed code blocks.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(source)  &#x21d2; <tt><span class='object_link'><a href="" title="Markdown::Merge::Cleanse::CodeFenceSpacing (class)">CodeFenceSpacing</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Create a new parser for the given text.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>source</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the text that may contain malformed code fences</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 98</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
  <span class='ivar'>@source</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='ivar'>@grammar</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="CodeFenceSpacing/CodeFenceGrammar.html" title="Markdown::Merge::Cleanse::CodeFenceSpacing::CodeFenceGrammar (class)">CodeFenceGrammar</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@code_blocks</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="source-instance_method">
  
    #<strong>source</strong>  &#x21d2; <tt>String</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the input text to parse.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the input text to parse</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


93
94
95</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 93</span>

<span class='kw'>def</span> <span class='id identifier rubyid_source'>source</span>
  <span class='ivar'>@source</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="code_blocks-instance_method">
  
    #<strong>code_blocks</strong>  &#x21d2; <tt>Array&lt;Hash&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Parse and return information about all fenced code blocks.</p>

<p>Only returns opening fences (not closing fences).</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of code block info</p>
<ul>
  <li>:fence [String] The fence markers (e.g., “```” or “~~~”)</li>
  <li>:language [String, nil] The language identifier</li>
  <li>:spacing [String] Any spacing between fence and language</li>
  <li>:malformed [Boolean] Whether this block has improper spacing</li>
  <li>:line_number [Integer] Line number where block starts (1-based)</li>
  <li>:original [String] The original opening fence line</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 125</span>

<span class='kw'>def</span> <span class='id identifier rubyid_code_blocks'>code_blocks</span>
  <span class='kw'>return</span> <span class='ivar'>@code_blocks</span> <span class='kw'>if</span> <span class='ivar'>@code_blocks</span>

  <span class='ivar'>@code_blocks</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_line_number'>line_number</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_in_code_block'>in_code_block</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_current_fence'>current_fence</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_each_line'>each_line</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
    <span class='id identifier rubyid_line_number'>line_number</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_match'>match</span> <span class='op'>=</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="#FENCE_PATTERN-constant" title="Markdown::Merge::Cleanse::CodeFenceSpacing::FENCE_PATTERN (constant)">FENCE_PATTERN</a></span></span><span class='rparen'>)</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_match'>match</span>

    <span class='id identifier rubyid_fence'>fence</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_spacing'>spacing</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_info'>info</span> <span class='op'>=</span> <span class='id identifier rubyid_match'>match</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># Determine if this is opening or closing fence
</span>    <span class='comment'># Closing fence: same fence type, no info string, and we&#39;re in a block
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_in_code_block'>in_code_block</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_fence'>fence</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span><span class='lparen'>(</span><span class='id identifier rubyid_current_fence'>current_fence</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='comment'># This is a closing fence - skip it
</span>      <span class='id identifier rubyid_in_code_block'>in_code_block</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_current_fence'>current_fence</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='comment'># This is an opening fence
</span>    <span class='id identifier rubyid_in_code_block'>in_code_block</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_current_fence'>current_fence</span> <span class='op'>=</span> <span class='id identifier rubyid_fence'>fence</span>

    <span class='comment'># Extract just the language (first word of info string)
</span>    <span class='id identifier rubyid_language'>language</span> <span class='op'>=</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_language'>language</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_language'>language</span><span class='op'>&amp;.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='ivar'>@code_blocks</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span>
      <span class='label'>fence:</span> <span class='id identifier rubyid_fence'>fence</span><span class='comma'>,</span>
      <span class='label'>language:</span> <span class='id identifier rubyid_language'>language</span><span class='comma'>,</span>
      <span class='label'>info_string:</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='comma'>,</span>
      <span class='label'>spacing:</span> <span class='id identifier rubyid_spacing'>spacing</span><span class='comma'>,</span>
      <span class='label'>malformed:</span> <span class='op'>!</span><span class='id identifier rubyid_spacing'>spacing</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_language'>language</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_language'>language</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span><span class='comma'>,</span>
      <span class='label'>line_number:</span> <span class='id identifier rubyid_line_number'>line_number</span><span class='comma'>,</span>
      <span class='label'>original:</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='comma'>,</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='ivar'>@code_blocks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="count-instance_method">
  
    #<strong>count</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Count the total number of code blocks.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>total number of fenced code blocks</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


200
201
202</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 200</span>

<span class='kw'>def</span> <span class='id identifier rubyid_count'>count</span>
  <span class='id identifier rubyid_code_blocks'>code_blocks</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fix-instance_method">
  
    #<strong>fix</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Fix malformed fenced code blocks by removing improper spacing.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the source with code fences fixed</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


176
177
178
179
180
181
182
183
184
185
186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 176</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fix'>fix</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_source'>source</span> <span class='kw'>unless</span> <span class='id identifier rubyid_malformed?'>malformed?</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>

  <span class='comment'># Process line by line, fixing malformed fences
</span>  <span class='id identifier rubyid_lines'>lines</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_lines'>lines</span>
  <span class='id identifier rubyid_fixed_lines'>fixed_lines</span> <span class='op'>=</span> <span class='id identifier rubyid_lines'>lines</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
    <span class='id identifier rubyid_fix_fence_line'>fix_fence_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_fixed_lines'>fixed_lines</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="malformed?-instance_method">
  
    #<strong>malformed?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Check if the source contains malformed fenced code blocks.</p>

<p>Detects the pattern where there’s whitespace between the fence<br />
markers and the language identifier.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>true if malformed fences are detected</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 110</span>

<span class='kw'>def</span> <span class='id identifier rubyid_malformed?'>malformed?</span>
  <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="#MALFORMED_PATTERN-constant" title="Markdown::Merge::Cleanse::CodeFenceSpacing::MALFORMED_PATTERN (constant)">MALFORMED_PATTERN</a></span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="malformed_count-instance_method">
  
    #<strong>malformed_count</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Count the number of malformed code blocks.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>number of malformed fences found</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


193
194
195</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 193</span>

<span class='kw'>def</span> <span class='id identifier rubyid_malformed_count'>malformed_count</span>
  <span class='id identifier rubyid_code_blocks'>code_blocks</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_block'>block</span><span class='op'>|</span> <span class='id identifier rubyid_block'>block</span><span class='lbracket'>[</span><span class='symbol'>:malformed</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Jan 19 02:23:38 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-4.0.1).
</div>

    </div>
  </body>
</html>