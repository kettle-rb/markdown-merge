<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Markdown::Merge::Cleanse::CodeFenceSpacing
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Markdown::Merge::Cleanse::CodeFenceSpacing";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Markdown.html" title="Markdown (module)">Markdown</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Merge.html" title="Markdown::Merge (module)">Merge</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Cleanse.html" title="Markdown::Merge::Cleanse (module)">Cleanse</a></span></span>
     &raquo; 
    <span class="title">CodeFenceSpacing</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Markdown::Merge::Cleanse::CodeFenceSpacing
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Markdown::Merge::Cleanse::CodeFenceSpacing</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/markdown/merge/cleanse/code_fence_spacing.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>Parslet-based parser for fixing malformed fenced code blocks in Markdown.</p>

<p>== The Problem</p>

<p>This class fixes <strong>improperly formatted fenced code blocks</strong> where there is<br />
unwanted whitespace between the fence markers (``` or ~~~) and the language<br />
identifier.</p>

<p>A bug in ast-merge (or its dependencies) caused fenced code blocks to be<br />
rendered with a space between the fence markers and the language identifier.</p>

<p>== Bug Pattern</p>

<p>CommonMark and most Markdown parsers expect NO space between fence and language:</p>
<ul>
  <li><strong>Correct:</strong> ` ```ruby<code> or </code> ~~~python`</li>
  <li><strong>Incorrect:</strong> ` ``` ruby<code> or </code> ~~~ python` (extra space)</li>
</ul>

<p>The extra space can cause:</p>
<ul>
  <li>Syntax highlighting to fail</li>
  <li>The language identifier to be ignored</li>
  <li>Rendering issues in various Markdown processors</li>
</ul>

<p>== Scope</p>

<p>This fixer handles:</p>
<ul>
  <li><strong>Any indentation level</strong> (0+ spaces before fence)
    <ul>
      <li>Top-level: ` ```ruby`</li>
      <li>In lists: `    ```python` (4 spaces)</li>
    </ul>
  </li>
  <li><strong>Both fence types:</strong> backticks (```) and tildes (~~~)</li>
  <li><strong>Any fence length:</strong> 3+ markers (````, ~~~~~, etc.)</li>
</ul>

<p>== How It Works</p>

<p>The parser uses a <strong>PEG grammar</strong> (via Parslet) to:</p>
<ul>
  <li>Detect fence opening lines with optional indentation</li>
  <li>Identify spacing between fence and language identifier</li>
  <li>Track opening/closing fence pairs to avoid false positives</li>
  <li>Reconstruct fences with proper formatting (no space)</li>
</ul>

<p><strong>Why PEG?</strong> The previous regex-based implementation used patterns like<br />
<code>([ \t]*)</code> which can cause polynomial backtracking (ReDoS vulnerability)<br />
when processing malicious input with many tabs/spaces. PEG parsers are<br />
linear-time and immune to ReDoS attacks.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
        <h5 class="example_title"><div class='inline'><p>Malformed (buggy) input</p>
</div></h5>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>``` console\nsome code\n```</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Fixed output</p>
</div></h5>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>```console\nsome code\n```</span><span class='tstring_end'>&quot;</span></span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Basic usage</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Markdown.html" title="Markdown (module)">Markdown</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Merge.html" title="Markdown::Merge (module)">Merge</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cleanse.html" title="Markdown::Merge::Cleanse (module)">Cleanse</a></span></span><span class='op'>::</span><span class='const'>CodeFenceSpacing</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::Cleanse::CodeFenceSpacing#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
<span class='id identifier rubyid_fixed_content'>fixed_content</span> <span class='op'>=</span> <span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_fix'>fix</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Check if content has malformed fences</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Markdown.html" title="Markdown (module)">Markdown</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Merge.html" title="Markdown::Merge (module)">Merge</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cleanse.html" title="Markdown::Merge::Cleanse (module)">Cleanse</a></span></span><span class='op'>::</span><span class='const'>CodeFenceSpacing</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::Cleanse::CodeFenceSpacing#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
<span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_malformed?'>malformed?</span> <span class='comment'># =&gt; true/false</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Process a file</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_content'>content</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>README.md</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Markdown.html" title="Markdown (module)">Markdown</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Merge.html" title="Markdown::Merge (module)">Merge</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cleanse.html" title="Markdown::Merge::Cleanse (module)">Cleanse</a></span></span><span class='op'>::</span><span class='const'>CodeFenceSpacing</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::Cleanse::CodeFenceSpacing#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
<span class='kw'>if</span> <span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_malformed?'>malformed?</span>
  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>README.md</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_fix'>fix</span><span class='rparen'>)</span>
<span class='kw'>end</span></code></pre>
    
      
        <h5 class="example_title"><div class='inline'><p>Get details about code blocks</p>
</div></h5>
      
      <pre class="example code"><code><span class='id identifier rubyid_parser'>parser</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Markdown.html" title="Markdown (module)">Markdown</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Merge.html" title="Markdown::Merge (module)">Merge</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Cleanse.html" title="Markdown::Merge::Cleanse (module)">Cleanse</a></span></span><span class='op'>::</span><span class='const'>CodeFenceSpacing</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Markdown::Merge::Cleanse::CodeFenceSpacing#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_content'>content</span><span class='rparen'>)</span>
<span class='id identifier rubyid_parser'>parser</span><span class='period'>.</span><span class='id identifier rubyid_code_blocks'>code_blocks</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_block'>block</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block'>block</span><span class='lbracket'>[</span><span class='symbol'>:fence</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block'>block</span><span class='lbracket'>[</span><span class='symbol'>:language</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>: malformed=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_block'>block</span><span class='lbracket'>[</span><span class='symbol'>:malformed</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></code></pre>
    
  </div>


</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="CodeFenceSpacing/CodeFenceGrammar.html" title="Markdown::Merge::Cleanse::CodeFenceSpacing::CodeFenceGrammar (class)">CodeFenceGrammar</a></span>
    
  
</p>




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#source-instance_method" title="#source (instance method)">#<strong>source</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The input text to parse.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#code_blocks-instance_method" title="#code_blocks (instance method)">#<strong>code_blocks</strong>  &#x21d2; Array&lt;Hash&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Parse and return information about all fenced code blocks.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#count-instance_method" title="#count (instance method)">#<strong>count</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Count the total number of code blocks.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fix-instance_method" title="#fix (instance method)">#<strong>fix</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Fix malformed fenced code blocks by removing improper spacing.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(source)  &#x21d2; CodeFenceSpacing </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Create a new parser for the given text.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#malformed%3F-instance_method" title="#malformed? (instance method)">#<strong>malformed?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Check if the source contains malformed fenced code blocks.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#malformed_count-instance_method" title="#malformed_count (instance method)">#<strong>malformed_count</strong>  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Count the number of malformed code blocks.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(source)  &#x21d2; <tt><span class='object_link'><a href="" title="Markdown::Merge::Cleanse::CodeFenceSpacing (class)">CodeFenceSpacing</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Create a new parser for the given text.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>source</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the text that may contain malformed code fences</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


133
134
135
136
137</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 133</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
  <span class='ivar'>@source</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='ivar'>@grammar</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="CodeFenceSpacing/CodeFenceGrammar.html" title="Markdown::Merge::Cleanse::CodeFenceSpacing::CodeFenceGrammar (class)">CodeFenceGrammar</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@code_blocks</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="source-instance_method">
  
    #<strong>source</strong>  &#x21d2; <tt>String</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns the input text to parse.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the input text to parse</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


128
129
130</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 128</span>

<span class='kw'>def</span> <span class='id identifier rubyid_source'>source</span>
  <span class='ivar'>@source</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="code_blocks-instance_method">
  
    #<strong>code_blocks</strong>  &#x21d2; <tt>Array&lt;Hash&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Parse and return information about all fenced code blocks.</p>

<p>Only returns opening fences (not closing fences).</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Hash&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Array of code block info</p>
<ul>
  <li>:indent [String] The indentation before the fence</li>
  <li>:fence [String] The fence markers (e.g., “```” or “~~~”)</li>
  <li>:language [String, nil] The language identifier</li>
  <li>:spacing [String] Any spacing between fence and language</li>
  <li>:malformed [Boolean] Whether this block has improper spacing</li>
  <li>:line_number [Integer] Line number where block starts (1-based)</li>
  <li>:original [String] The original opening fence line</li>
</ul>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 161</span>

<span class='kw'>def</span> <span class='id identifier rubyid_code_blocks'>code_blocks</span>
  <span class='kw'>return</span> <span class='ivar'>@code_blocks</span> <span class='kw'>if</span> <span class='ivar'>@code_blocks</span>

  <span class='ivar'>@code_blocks</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_line_number'>line_number</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_in_code_block'>in_code_block</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_current_fence_char'>current_fence_char</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_each_line'>each_line</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
    <span class='id identifier rubyid_line_number'>line_number</span> <span class='op'>+=</span> <span class='int'>1</span>

    <span class='comment'># Try to parse as fence line using PEG grammar
</span>    <span class='id identifier rubyid_parsed'>parsed</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_fence_line'>parse_fence_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_parsed'>parsed</span>

    <span class='id identifier rubyid_fence'>fence</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed'>parsed</span><span class='lbracket'>[</span><span class='symbol'>:fence</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_fence_char'>fence_char</span> <span class='op'>=</span> <span class='id identifier rubyid_fence'>fence</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_spacing'>spacing</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed'>parsed</span><span class='lbracket'>[</span><span class='symbol'>:spacing</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_info'>info</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed'>parsed</span><span class='lbracket'>[</span><span class='symbol'>:info</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_indent'>indent</span> <span class='op'>=</span> <span class='id identifier rubyid_parsed'>parsed</span><span class='lbracket'>[</span><span class='symbol'>:indent</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>

    <span class='comment'># Closing fence: matches current fence type and has no info
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_in_code_block'>in_code_block</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_fence_char'>fence_char</span> <span class='op'>==</span> <span class='id identifier rubyid_current_fence_char'>current_fence_char</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_in_code_block'>in_code_block</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_current_fence_char'>current_fence_char</span> <span class='op'>=</span> <span class='kw'>nil</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='comment'># Opening fence
</span>    <span class='id identifier rubyid_in_code_block'>in_code_block</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_current_fence_char'>current_fence_char</span> <span class='op'>=</span> <span class='id identifier rubyid_fence_char'>fence_char</span>

    <span class='comment'># Extract just the language (first word of info string)
</span>    <span class='id identifier rubyid_language'>language</span> <span class='op'>=</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\s+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_language'>language</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_language'>language</span><span class='op'>&amp;.</span><span class='id identifier rubyid_empty?'>empty?</span>

    <span class='ivar'>@code_blocks</span> <span class='op'>&lt;&lt;</span> <span class='lbrace'>{</span>
      <span class='label'>indent:</span> <span class='id identifier rubyid_indent'>indent</span><span class='comma'>,</span>
      <span class='label'>fence:</span> <span class='id identifier rubyid_fence'>fence</span><span class='comma'>,</span>
      <span class='label'>language:</span> <span class='id identifier rubyid_language'>language</span><span class='comma'>,</span>
      <span class='label'>info_string:</span> <span class='id identifier rubyid_info'>info</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='comma'>,</span>
      <span class='label'>spacing:</span> <span class='id identifier rubyid_spacing'>spacing</span><span class='comma'>,</span>
      <span class='label'>malformed:</span> <span class='op'>!</span><span class='id identifier rubyid_spacing'>spacing</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_language'>language</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='comma'>,</span>
      <span class='label'>line_number:</span> <span class='id identifier rubyid_line_number'>line_number</span><span class='comma'>,</span>
      <span class='label'>original:</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span><span class='comma'>,</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='ivar'>@code_blocks</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="count-instance_method">
  
    #<strong>count</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Count the total number of code blocks.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>total number of fenced code blocks</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


239
240
241</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 239</span>

<span class='kw'>def</span> <span class='id identifier rubyid_count'>count</span>
  <span class='id identifier rubyid_code_blocks'>code_blocks</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fix-instance_method">
  
    #<strong>fix</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Fix malformed fenced code blocks by removing improper spacing.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the source with code fences fixed</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


215
216
217
218
219
220
221
222
223
224
225
226
227</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 215</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fix'>fix</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_source'>source</span> <span class='kw'>unless</span> <span class='id identifier rubyid_malformed?'>malformed?</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_source'>source</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>

  <span class='comment'># Process line by line, fixing malformed fences
</span>  <span class='id identifier rubyid_lines'>lines</span> <span class='op'>=</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_lines'>lines</span>
  <span class='id identifier rubyid_fixed_lines'>fixed_lines</span> <span class='op'>=</span> <span class='id identifier rubyid_lines'>lines</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_line'>line</span><span class='op'>|</span>
    <span class='id identifier rubyid_fix_fence_line'>fix_fence_line</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_fixed_lines'>fixed_lines</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="malformed?-instance_method">
  
    #<strong>malformed?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Check if the source contains malformed fenced code blocks.</p>

<p>Detects the pattern where there’s whitespace between the fence<br />
markers and the language identifier.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>true if malformed fences are detected</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


145
146
147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 145</span>

<span class='kw'>def</span> <span class='id identifier rubyid_malformed?'>malformed?</span>
  <span class='id identifier rubyid_code_blocks'>code_blocks</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_block'>block</span><span class='op'>|</span> <span class='id identifier rubyid_block'>block</span><span class='lbracket'>[</span><span class='symbol'>:malformed</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="malformed_count-instance_method">
  
    #<strong>malformed_count</strong>  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Count the number of malformed code blocks.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>number of malformed fences found</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


232
233
234</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/markdown/merge/cleanse/code_fence_spacing.rb', line 232</span>

<span class='kw'>def</span> <span class='id identifier rubyid_malformed_count'>malformed_count</span>
  <span class='id identifier rubyid_code_blocks'>code_blocks</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_block'>block</span><span class='op'>|</span> <span class='id identifier rubyid_block'>block</span><span class='lbracket'>[</span><span class='symbol'>:malformed</span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Feb  1 14:40:45 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-4.0.1).
</div>

    </div>
  </body>
</html>